<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIGI-Requ√™te Universitaire</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #bbc5f0;
            margin-bottom: 10px;
        }

        .nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .nav button {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #d9e097, #121113);
            color: white;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .nav button:hover {
            transform: translateY(-2px);
        }

        .nav button.active {
            background: linear-gradient(45deg, #d2e2a0, #eef1f3);
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #031253;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #f3f5fa, #0f04ab);
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn.secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }

        .btn.success {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }

        .btn.warning {
            background: linear-gradient(45deg, #f39c12, #e67e22);
        }

        .btn.danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #667eea;
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .status {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .status.processing {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status.resolved {
            background: #d4edda;
            color: #155724;
        }

        .user-info {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .payment-section {
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .payment-methods {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .payment-method {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-method:hover, .payment-method.selected {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(45deg, #2ecc71, #27ae60);
        }

        .notification.error {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
                align-items: center;
            }

            .payment-methods {
                flex-direction: column;
                align-items: center;
            }

            .container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Gestion de requ√™te - FS/UMa</h1>
            <p>Plateforme de gestion des requ√™tes acad√©miques et administratives</p>
            
            <div class="nav" id="navigation">
                <button onclick="showSection('login')" class="active">Connexion</button>
                <button onclick="showSection('register')" style="display: none;">Inscription</button>
                <button onclick="showSection('dashboard')" style="display: none;">Tableau de Bord</button>
                <button onclick="showSection('submit-request')" style="display: none;">Nouvelle Requ√™te</button>
                <button onclick="showSection('my-requests')" style="display: none;">Mes Requ√™tes</button>
                <button onclick="showSection('admin-panel')" style="display: none;">Administration</button>
                <button onclick="logout()" style="display: none;">D√©connexion</button>
            </div>
        </div>

        <!-- Section Connexion -->
        <div class="section active" id="login">
            <h2>üîê Connexion</h2>
            <form onsubmit="login(event)">
                <div class="form-group">
                    <label for="loginMatricule">Matricule</label>
                    <input type="text" id="loginMatricule" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn">Se connecter</button>
                <button type="button" class="btn secondary" onclick="showSection('register')">S'inscrire</button>
            </form>
        </div>

        <!-- Section Inscription -->
        <div class="section" id="register">
            <h2>üìù Inscription</h2>
            <form onsubmit="register(event)">
                <div class="grid">
                    <div class="form-group">
                        <label for="nom">Nom complet</label>
                        <input type="text" id="nom" required>
                    </div>
                    <div class="form-group">
                        <label for="matricule">Matricule (unique)</label>
                        <input type="text" id="matricule" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email (facultatif)</label>
                        <input type="email" id="email">
                    </div>
                    <div class="form-group">
                        <label for="telephone">T√©l√©phone</label>
                        <input type="tel" id="telephone" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Mot de passe</label>
                        <input type="password" id="password" required>
                    </div>
                    <div class="form-group">
                        <label for="etablissement">√âtablissement</label>
                        <input type="text" id="etablissement" required>
                    </div>
                    <div class="form-group">
                        <label for="departement">D√©partement</label>
                        <select id="departement" required>
                            <option value="">Choisir un d√©partement</option>
                            <option value="Informatique">Informatique</option>
                            <option value="Math√©matiques">Math√©matiques</option>
                            <option value="Physique">Physique</option>
                            <option value="Chimie">Chimie</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filiere">Fili√®re</label>
                        <input type="text" id="filiere" required>
                    </div>
                    <div class="form-group">
                        <label for="niveau">Niveau</label>
                        <select id="niveau" required>
                            <option value="">Choisir un niveau</option>
                            <option value="L1">Licence 1</option>
                            <option value="L2">Licence 2</option>
                            <option value="L3">Licence 3</option>
                            <option value="M1">Master 1</option>
                            <option value="M2">Master 2</option>
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn">S'inscrire</button>
                <button type="button" class="btn secondary" onclick="showSection('login')">Retour √† la connexion</button>
            </form>
        </div>

        <!-- Tableau de Bord -->
        <div class="section" id="dashboard">
            <div class="user-info" id="userInfo">
                <!-- Informations utilisateur -->
            </div>
            
            <div class="grid">
                <div class="card">
                    <h3>üìä Statistiques</h3>
                    <p>Requ√™tes en attente: <strong id="pendingCount">0</strong></p>
                    <p>Requ√™tes en traitement: <strong id="processingCount">0</strong></p>
                    <p>Requ√™tes r√©solues: <strong id="resolvedCount">0</strong></p>
                </div>
                
                <div class="card">
                    <h3> Actions rapides</h3>
                    <button class="btn" onclick="showSection('submit-request')">Nouvelle Requ√™te</button>
                    <button class="btn secondary" onclick="showSection('my-requests')">Voir mes requ√™tes</button>
                </div>
            </div>
        </div>

        <!-- Soumission de Requ√™te -->
        <div class="section" id="submit-request">
            <h2> Nouvelle Requ√™te</h2>
            <form id="requestForm">
                <div class="form-group">
                    <label for="problemType">Type de probl√®me</label>
                    <select id="problemType" required onchange="toggleUnitSelection()">
                        <option value="">Choisir un type</option>
                        <option value="note">Probl√®me de note</option>
                        <option value="profils">profils</option>
                        <option value="attestation">Attestation</option>
                        <option value="certificat">Certificat</option>
                        <option value="autre">Autre</option>
                    </select>
                </div>

                <div id="unitSelection" style="display: none;">
                    <div class="form-group">
                        <label for="unite">Unit√© d'enseignement</label>
                        <select id="unite">
                            <option value="">Choisir une unit√©</option>
                            <option value="Algorithmes">Algorithmes</option>
                            <option value="Base de donn√©es">Base de donn√©es</option>
                            <option value="R√©seaux">R√©seaux</option>
                            <option value="Programmation">Programmation</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="enseignant">Enseignant responsable</label>
                        <select id="enseignant">
                            <option value="">Choisir un enseignant</option>
                            <option value="Prof. Martin">Prof. Martin</option>
                            <option value="Dr. Dubois">Dr. Dubois</option>
                            <option value="Prof. Bernard">Prof. Bernard</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="description">Description d√©taill√©e</label>
                    <textarea id="description" rows="5" required placeholder="D√©crivez votre probl√®me en d√©tail..."></textarea>
                </div>

                <div class="payment-section">
                    <h3>üí≥ Paiement requis - 100 FCFA</h3>
                    <p>Veuillez effectuer le paiement avant de soumettre votre requ√™te</p>
                    
                    <div class="payment-methods">
                        <div class="payment-method" onclick="selectPaymentMethod('orange')">
                            <div>üü† Orange Money</div>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod('mtn')">
                            <div>üü° MTN Mobile Money</div>
                        </div>
                    </div>

                    <div id="paymentDetails" style="display: none;">
                        <div class="form-group">
                            <label for="phoneNumber">Num√©ro de t√©l√©phone</label>
                            <input type="tel" id="phoneNumber" placeholder="Ex: +237 6XX XXX XXX">
                        </div>
                        <button type="button" class="btn warning" onclick="processPayment()">Effectuer le paiement</button>
                    </div>
                </div>

                <button type="button" class="btn" id="submitBtn" disabled onclick="submitRequest()">Soumettre la requ√™te</button>
            </form>
        </div>

        <!-- Mes Requ√™tes -->
        <div class="section" id="my-requests">
            <h2>üìÑ Mes Requ√™tes</h2>
            <div id="requestsList">
                <!-- Liste des requ√™tes -->
            </div>
        </div>

        <!-- Panneau d'Administration -->
        <div class="section" id="admin-panel">
            <h2>‚öôÔ∏è Panneau d'Administration</h2>
            <div id="adminContent">
                <div class="card">
                    <h3>Toutes les requ√™tes</h3>
                    <div id="allRequestsList">
                        <!-- Liste de toutes les requ√™tes -->
                    </div>
                </div>
                
                <div class="card">
                    <h3>Actions administratives</h3>
                    <button class="btn" onclick="generateReport()">G√©n√©rer un rapport PDF</button>
                    <button class="btn secondary" onclick="manageTeachers()">G√©rer les enseignants</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Paiement -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <h3>üîÑ Traitement du paiement</h3>
            <p>Veuillez confirmer le paiement sur votre t√©l√©phone...</p>
            <div style="margin: 20px 0;">
                <div style="border: 3px solid #667eea; border-top: 3px solid transparent; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto;"></div>
            </div>
            <button class="btn secondary" onclick="closePaymentModal()">Annuler</button>
        </div>
    </div>

    <!-- Notifications -->
    <div class="notification" id="notification"></div>

    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <script>
        // Variables globales
        let currentUser = null;
        let selectedPaymentMethod = null;
        let paymentCompleted = false;
        let requests = [];
        let users = [];

        // Donn√©es de d√©monstration
        const demoUsers = [
            {
                matricule: "20210001",
                password: "demo123",
                nom: "M Hamidou",
                email: "jean@example.com",
                telephone: "+237 6XX XXX XXX",
                etablissement: "Universit√© de Yaound√© I",
                departement: "Informatique",
                filiere: "G√©nie Logiciel",
                niveau: "L3",
                role: "student"
            },
            {
                matricule: "ADMIN001",
                password: "admin123",
                nom: "Pr. Dongho",
                role: "chef_departement",
                departement: "Informatique"
            },
            {
                matricule: "PROF001",
                password: "prof123",
                nom: "M Bayang Souloukna",
                role: "enseignant",
                unites: ["Algorithmes", "Base de donn√©es"]
            }
        ];

        // Initialisation
        function init() {
            // Charger les donn√©es de d√©monstration
            if (!localStorage.getItem('digi_users')) {
                localStorage.setItem('digi_users', JSON.stringify(demoUsers));
            }
            
            users = JSON.parse(localStorage.getItem('digi_users')) || demoUsers;
            requests = JSON.parse(localStorage.getItem('digi_requests')) || [];
            
            updateStats();
        }

        // Gestion des sections
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            
            document.querySelectorAll('.nav button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Connexion
        function login(event) {
            event.preventDefault();
            const matricule = document.getElementById('loginMatricule').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.matricule === matricule && u.password === password);
            
            if (user) {
                currentUser = user;
                showNotification('Connexion r√©ussie !', 'success');
                updateNavigation();
                showUserDashboard();
            } else {
                showNotification('Identifiants incorrects', 'error');
            }
        }

        // Inscription
        function register(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const userData = {
                nom: document.getElementById('nom').value,
                matricule: document.getElementById('matricule').value,
                email: document.getElementById('email').value,
                telephone: document.getElementById('telephone').value,
                password: document.getElementById('password').value,
                etablissement: document.getElementById('etablissement').value,
                departement: document.getElementById('departement').value,
                filiere: document.getElementById('filiere').value,
                niveau: document.getElementById('niveau').value,
                role: 'student'
            };
            
            // V√©rifier si le matricule existe d√©j√†
            if (users.find(u => u.matricule === userData.matricule)) {
                showNotification('Ce matricule existe d√©j√†', 'error');
                return;
            }
            
            users.push(userData);
            localStorage.setItem('digi_users', JSON.stringify(users));
            showNotification('Inscription r√©ussie ! Vous pouvez maintenant vous connecter.', 'success');
            showSection('login');
        }

        // Mise √† jour de la navigation
        function updateNavigation() {
            const nav = document.getElementById('navigation');
            nav.innerHTML = '';
            
            if (currentUser) {
                if (currentUser.role === 'student') {
                    nav.innerHTML = `
                        <button onclick="showSection('dashboard')" class="active">Tableau de Bord</button>
                        <button onclick="showSection('submit-request')">Nouvelle Requ√™te</button>
                        <button onclick="showSection('my-requests')">Mes Requ√™tes</button>
                        <button onclick="logout()">D√©connexion</button>
                    `;
                } else {
                    nav.innerHTML = `
                        <button onclick="showSection('dashboard')" class="active">Tableau de Bord</button>
                        <button onclick="showSection('admin-panel')">Administration</button>
                        <button onclick="logout()">D√©connexion</button>
                    `;
                }
            }
        }

        // Affichage du tableau de bord
        function showUserDashboard() {
            document.getElementById('userInfo').innerHTML = `
                <h3>üëã Bienvenue, ${currentUser.nom}</h3>
                <p><strong>Matricule:</strong> ${currentUser.matricule}</p>
                <p><strong>D√©partement:</strong> ${currentUser.departement}</p>
                ${currentUser.filiere ? `<p><strong>Fili√®re:</strong> ${currentUser.filiere}</p>` : ''}
                ${currentUser.niveau ? `<p><strong>Niveau:</strong> ${currentUser.niveau}</p>` : ''}
            `;
            
            updateStats();
            loadMyRequests();
            if (currentUser.role !== 'student') {
                loadAllRequests();
            }
            showSection('dashboard');
        }

        // Gestion des m√©thodes de paiement
        function selectPaymentMethod(method) {
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            event.target.closest('.payment-method').classList.add('selected');
            selectedPaymentMethod = method;
            document.getElementById('paymentDetails').style.display = 'block';
        }

        function toggleUnitSelection() {
            const problemType = document.getElementById('problemType').value;
            const unitSelection = document.getElementById('unitSelection');
            
            if (problemType === 'note' || problemType === 'profils') {
                unitSelection.style.display = 'block';
            } else {
                unitSelection.style.display = 'none';
            }
        }

        // Traitement du paiement
        function processPayment() {
            if (!selectedPaymentMethod) {
                showNotification('Veuillez s√©lectionner une m√©thode de paiement', 'error');
                return;
            }
            
            const phoneNumber = document.getElementById('phoneNumber').value;
            if (!phoneNumber) {
                showNotification('Veuillez saisir votre num√©ro de t√©l√©phone', 'error');
                return;
            }
            
            // Simulation du modal de paiement
            document.getElementById('paymentModal').classList.add('active');
            
            // Simulation du d√©lai de paiement
            setTimeout(() => {
                document.getElementById('paymentModal').classList.remove('active');
                paymentCompleted = true;
                document.getElementById('submitBtn').disabled = false;
                showNotification('Paiement effectu√© avec succ√®s !', 'success');
            }, 3000);
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').classList.remove('active');
        }

        // Soumission de requ√™te
        function submitRequest() {
            if (!paymentCompleted) {
                showNotification('Veuillez effectuer le paiement avant de soumettre', 'error');
                return;
            }
            
            const request = {
                id: Date.now(),
                userId: currentUser.matricule,
                userName: currentUser.nom,
                departement: currentUser.departement,
                problemType: document.getElementById('problemType').value,
                unite: document.getElementById('unite').value,
                enseignant: document.getElementById('enseignant').value,
                description: document.getElementById('description').value,
                status: 'En attente',
                dateSubmission: new Date().toLocaleDateString('fr-FR'),
                responses: [],
                paymentMethod: selectedPaymentMethod,
                paymentCompleted: true
            };
            
            requests.push(request);
            localStorage.setItem('digi_requests', JSON.stringify(requests));
            
            showNotification('Requ√™te soumise avec succ√®s !', 'success');
            
            // R√©initialiser le formulaire
            document.getElementById('requestForm').reset();
            paymentCompleted = false;
            selectedPaymentMethod = null;
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('paymentDetails').style.display = 'none';
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            
            updateStats();
            showSection('my-requests');
            loadMyRequests();
        }

        // Chargement des requ√™tes personnelles
        function loadMyRequests() {
            const userRequests = requests.filter(r => r.userId === currentUser.matricule);
            const container = document.getElementById('requestsList');
            
            if (userRequests.length === 0) {
                container.innerHTML = '<p>Aucune requ√™te trouv√©e.</p>';
                return;
            }
            
            container.innerHTML = userRequests.map(request => `
                <div class="card">
                    <h3>${request.problemType.charAt(0).toUpperCase() + request.problemType.slice(1)}</h3>
                    <p><strong>Date:</strong> ${request.dateSubmission}</p>
                    ${request.unite ? `<p><strong>Unit√©:</strong> ${request.unite}</p>` : ''}
                    ${request.enseignant ? `<p><strong>Enseignant:</strong> ${request.enseignant}</p>` : ''}
                    <p><strong>Description:</strong> ${request.description}</p>
                    <p><strong>Statut:</strong> <span class="status ${request.status.toLowerCase().replace(' ', '')}">${request.status}</span></p>
                    ${request.responses.length > 0 ? `
                        <div style="margin-top: 15px;">
                            <strong>R√©ponses:</strong>
                            ${request.responses.map(response => `
                                <div style="background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 5px;">
                                    <small><strong>${response.author}</strong> - ${response.date}</small>
                                    <p>${response.message}</p>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Chargement de toutes les requ√™tes (Admin)
        function loadAllRequests() {
            if (currentUser.role === 'student') return;
            
            let filteredRequests = requests;
            
            // Filtrer selon le r√¥le
            if (currentUser.role === 'enseignant') {
                filteredRequests = requests.filter(r => 
                    currentUser.unites && currentUser.unites.includes(r.unite)
                );
            } else if (currentUser.role === 'chef_departement') {
                filteredRequests = requests.filter(r => r.departement === currentUser.departement);
            }
            
            const container = document.getElementById('allRequestsList');
            
            if (filteredRequests.length === 0) {
                container.innerHTML = '<p>Aucune requ√™te trouv√©e.</p>';
                return;
            }
            
            container.innerHTML = filteredRequests.map(request => `
                <div class="card">
                    <h3>${request.problemType.charAt(0).toUpperCase() + request.problemType.slice(1)} - ${request.userName}</h3>
                    <p><strong>Matricule:</strong> ${request.userId}</p>
                    <p><strong>Date:</strong> ${request.dateSubmission}</p>
                    ${request.unite ? `<p><strong>Unit√©:</strong> ${request.unite}</p>` : ''}
                    ${request.enseignant ? `<p><strong>Enseignant:</strong> ${request.enseignant}</p>` : ''}
                    <p><strong>Description:</strong> ${request.description}</p>
                    <p><strong>Statut:</strong> <span class="status ${request.status.toLowerCase().replace(' ', '')}">${request.status}</span></p>
                    
                    <div style="margin-top: 15px;">
                        <select id="status-${request.id}" onchange="updateRequestStatus(${request.id})">
                            <option value="En attente" ${request.status === 'En attente' ? 'selected' : ''}>En attente</option>
                            <option value="En traitement" ${request.status === 'En traitement' ? 'selected' : ''}>En traitement</option>
                            <option value="R√©solue" ${request.status === 'R√©solue' ? 'selected' : ''}>R√©solue</option>
                        </select>
                        
                        ${currentUser.role === 'chef_departement' ? `
                            <select id="assign-${request.id}" onchange="assignRequest(${request.id})">
                                <option value="">Assigner √† un enseignant</option>
                                <option value="Prof. Martin">Prof. Martin</option>
                                <option value="Dr. Dubois">Dr. Dubois</option>
                                <option value="Prof. Bernard">Prof. Bernard</option>
                            </select>
                        ` : ''}
                        
                        <button class="btn secondary" onclick="respondToRequest(${request.id})">R√©pondre</button>
                    </div>
                    
                    ${request.responses.length > 0 ? `
                        <div style="margin-top: 15px;">
                            <strong>R√©ponses:</strong>
                            ${request.responses.map(response => `
                                <div style="background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 5px;">
                                    <small><strong>${response.author}</strong> - ${response.date}</small>
                                    <p>${response.message}</p>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Mise √† jour du statut d'une requ√™te
        function updateRequestStatus(requestId) {
            const newStatus = document.getElementById(`status-${requestId}`).value;
            const requestIndex = requests.findIndex(r => r.id === requestId);
            
            if (requestIndex !== -1) {
                requests[requestIndex].status = newStatus;
                localStorage.setItem('digi_requests', JSON.stringify(requests));
                showNotification('Statut mis √† jour avec succ√®s', 'success');
                updateStats();
                loadMyRequests();
            }
        }

        // Assignation d'une requ√™te
        function assignRequest(requestId) {
            const teacherName = document.getElementById(`assign-${requestId}`).value;
            if (!teacherName) return;
            
            const requestIndex = requests.findIndex(r => r.id === requestId);
            if (requestIndex !== -1) {
                requests[requestIndex].enseignant = teacherName;
                requests[requestIndex].status = 'En traitement';
                localStorage.setItem('digi_requests', JSON.stringify(requests));
                showNotification(`Requ√™te assign√©e √† ${teacherName}`, 'success');
                loadAllRequests();
                updateStats();
            }
        }

        // R√©pondre √† une requ√™te
        function respondToRequest(requestId) {
            const response = prompt('Votre r√©ponse:');
            if (!response) return;
            
            const requestIndex = requests.findIndex(r => r.id === requestId);
            if (requestIndex !== -1) {
                requests[requestIndex].responses.push({
                    author: currentUser.nom,
                    message: response,
                    date: new Date().toLocaleDateString('fr-FR')
                });
                localStorage.setItem('digi_requests', JSON.stringify(requests));
                showNotification('R√©ponse ajout√©e avec succ√®s', 'success');
                loadAllRequests();
                loadMyRequests();
            }
        }

        // Mise √† jour des statistiques
        function updateStats() {
            let userRequests = [];
            
            if (currentUser) {
                if (currentUser.role === 'student') {
                    userRequests = requests.filter(r => r.userId === currentUser.matricule);
                } else if (currentUser.role === 'enseignant') {
                    userRequests = requests.filter(r => 
                        currentUser.unites && currentUser.unites.includes(r.unite)
                    );
                } else if (currentUser.role === 'chef_departement') {
                    userRequests = requests.filter(r => r.departement === currentUser.departement);
                }
            }
            
            const pendingCount = userRequests.filter(r => r.status === 'En attente').length;
            const processingCount = userRequests.filter(r => r.status === 'En traitement').length;
            const resolvedCount = userRequests.filter(r => r.status === 'R√©solue').length;
            
            document.getElementById('pendingCount').textContent = pendingCount;
            document.getElementById('processingCount').textContent = processingCount;
            document.getElementById('resolvedCount').textContent = resolvedCount;
        }

        // G√©n√©ration de rapport PDF (simulation)
        function generateReport() {
            showNotification('G√©n√©ration du rapport PDF en cours...', 'success');
            
            // Simulation de la g√©n√©ration PDF
            setTimeout(() => {
                const reportData = {
                    date: new Date().toLocaleDateString('fr-FR'),
                    departement: currentUser.departement,
                    totalRequests: requests.length,
                    pendingRequests: requests.filter(r => r.status === 'En attente').length,
                    processingRequests: requests.filter(r => r.status === 'En traitement').length,
                    resolvedRequests: requests.filter(r => r.status === 'R√©solue').length
                };
                
                // Cr√©er un lien de t√©l√©chargement simul√©
                const blob = new Blob([`
                    RAPPORT DIGI-REQU√äTE
                    =====================
                    
                    Date: ${reportData.date}
                    D√©partement: ${reportData.departement}
                    
                    STATISTIQUES:
                    - Total des requ√™tes: ${reportData.totalRequests}
                    - En attente: ${reportData.pendingRequests}
                    - En traitement: ${reportData.processingRequests}
                    - R√©solues: ${reportData.resolvedRequests}
                    
                    D√âTAIL DES REQU√äTES:
                    ${requests.map(r => `
                    ID: ${r.id}
                    √âtudiant: ${r.userName} (${r.userId})
                    Type: ${r.problemType}
                    Statut: ${r.status}
                    Date: ${r.dateSubmission}
                    Description: ${r.description}
                    -------------------
                    `).join('')}
                `], { type: 'text/plain' });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `rapport-digi-requete-${new Date().toISOString().split('T')[0]}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                
                showNotification('Rapport t√©l√©charg√© avec succ√®s !', 'success');
            }, 2000);
        }

        // Gestion des enseignants
        function manageTeachers() {
            const teacherManagement = `
                <div class="modal active" id="teacherModal">
                    <div class="modal-content">
                        <h3>üë®‚Äçüè´ Gestion des Enseignants</h3>
                        <p>Fonctionnalit√© de gestion des enseignants</p>
                        <div style="margin: 20px 0;">
                            <button class="btn" onclick="addTeacher()">Ajouter un enseignant</button>
                            <button class="btn secondary" onclick="viewTeachers()">Voir les enseignants</button>
                        </div>
                        <button class="btn secondary" onclick="closeTeacherModal()">Fermer</button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', teacherManagement);
        }

        function closeTeacherModal() {
            const modal = document.getElementById('teacherModal');
            if (modal) modal.remove();
        }

        function addTeacher() {
            const name = prompt('Nom de l\'enseignant:');
            const matricule = prompt('Matricule:');
            const unites = prompt('Unit√©s (s√©par√©es par des virgules):');
            
            if (name && matricule && unites) {
                const newTeacher = {
                    nom: name,
                    matricule: matricule,
                    role: 'enseignant',
                    unites: unites.split(',').map(u => u.trim()),
                    departement: currentUser.departement,
                    password: 'temp123'
                };
                
                users.push(newTeacher);
                localStorage.setItem('digi_users', JSON.stringify(users));
                showNotification('Enseignant ajout√© avec succ√®s', 'success');
            }
        }

        function viewTeachers() {
            const teachers = users.filter(u => u.role === 'enseignant' && u.departement === currentUser.departement);
            const teacherList = teachers.map(t => `
                ${t.nom} (${t.matricule}) - Unit√©s: ${t.unites ? t.unites.join(', ') : 'Aucune'}
            `).join('\n');
            
            alert(`Enseignants du d√©partement ${currentUser.departement}:\n\n${teacherList}`);
        }

        // Affichage des notifications
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // D√©connexion
        function logout() {
            currentUser = null;
            showNotification('D√©connexion r√©ussie', 'success');
            
            // R√©initialiser la navigation
            document.getElementById('navigation').innerHTML = `
                <button onclick="showSection('login')" class="active">Connexion</button>
                <button onclick="showSection('register')">Inscription</button>
            `;
            
            showSection('login');
        }

        // Fonctions utilitaires pour la d√©monstration
        function addDemoData() {
            // Ajouter quelques requ√™tes de d√©monstration
            const demoRequests = [
                {
                    id: 1,
                    userId: "20210001",
                    userName: "M Bayang Souloukna",
                    departement: "Informatique",
                    problemType: "note",
                    unite: "Algorithmes",
                    enseignant: "M Bayang Souloukna",
                    description: "Je conteste ma note √† l'examen d'algorithmes",
                    status: "En attente",
                    dateSubmission: "15/07/2025",
                    responses: [],
                    paymentMethod: "orange",
                    paymentCompleted: true
                },
                {
                    id: 2,
                    userId: "20210001",
                    userName: "M Bayang Souloukna",
                    departement: "Informatique",
                    problemType: "attestation",
                    description: "Demande d'attestation de scolarit√©",
                    status: "R√©solue",
                    dateSubmission: "10/07/2025",
                    responses: [
                        {
                            author: "Pr. Dongho Joseph",
                            message: "Votre attestation est pr√™te. Vous pouvez la r√©cup√©rer au secr√©tariat.",
                            date: "12/07/2025"
                        }
                    ],
                    paymentMethod: "mtn",
                    paymentCompleted: true
                }
            ];
            
            if (requests.length === 0) {
                requests = demoRequests;
                localStorage.setItem('digi_requests', JSON.stringify(requests));
            }
        }

        // Initialisation au chargement de la page
        window.addEventListener('load', () => {
            init();
            addDemoData();
            
            // Message d'aide pour la d√©monstration
            setTimeout(() => {
                showNotification('Comptes de d√©monstration disponibles - √âtudiant: 20210001/demo123, Admin: ADMIN001/admin123, Prof: PROF001/prof123', 'success');
            }, 1000);
        });

        // Gestionnaire d'√©v√©nements pour les touches
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const modals = document.querySelectorAll('.modal.active');
                modals.forEach(modal => modal.classList.remove('active'));
            }
        });

        // Responsivit√© pour mobile
        function handleResize() {
            if (window.innerWidth < 768) {
                document.body.classList.add('mobile');
            } else {
                document.body.classList.remove('mobile');
            }
        }

        window.addEventListener('resize', handleResize);
        handleResize();
    </script>
</body>
</html>